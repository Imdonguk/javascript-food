<script>
var data;   
function ajax() {
var oReq = new XMLHttpRequest();
   
 oReq.addEventListener("load", function() {
    data = JSON.parse(this.responseText);

    makeLiList();
    makeTab();
    bestTabinit();
 });
   
  oReq.open("GET", "http://crong.codesquad.kr:8080/woowa/best");
  oReq.send();
}
ajax();

//best_tabs의 li 생성 , 삽입내용 , name , category_id
function makeLiList() { 
    var ul = document.querySelector(".best_tabs");
    data.forEach(function(key,index){
        var node = document.createElement("li");
        node.id = key.category_id;
        node.innerHTML = key.name; 
        ul.appendChild(node);
    });
}

//best_detail
function makeTab(){
    var container = document.querySelector(".best_container");
    data.forEach(function(key,index){
        var ul = document.createElement("ul");
        ul.className = key.category_id;
        
        //함수화? tag = [li,a,img] , value = [{class:detail_hash},{},{src:"url"} ... ];
        key.items.forEach(function(key,index){  //캬아악
            
            var li = document.createElement("li");
            var a = document.createElement("a");
            var img = document.createElement("img");
            var div1 = document.createElement("div");
            var dl = document.createElement("dl");
            var dt = document.createElement("dt");
            var dd = document.createElement("dd");
            var div2 = document.createElement("div");
            var span1 = document.createElement("span");
            var span2 = document.createElement("span");//cloneNode를 쓰자
            var span3 = document.createElement("span");

            li.className = key.detail_hash;
            img.src = key.image;
            div1.className = "best_detail";
            dt.innerText=key.title;
            dd.innerText=key.description;
            div2.className = "price";
            span1.className = "before";
            key.n_price ? span1.innerText = key.n_price : "";
            span2.innerText = " "+key.s_price;
            span2.className = "after";
            span3.innerText = "";
            
            ul.appendChild(li);//반복문? 맙소사
            li.appendChild(a);
            a.appendChild(img);
            a.appendChild(div1);
            div1.appendChild(dl);
            dl.appendChild(dt);
            dl.appendChild(dd);
            div1.appendChild(div2);
            div2.appendChild(span1);
            div2.appendChild(span2);
            span2.appendChild(span3);
        });
        container.appendChild(ul);
    });
}


function bestTabinit(){
    var ul = document.querySelector(".best_container").children;
    var i,length = ul.length;
    
    //best_detail 하나 이외의 탭들은 display none 처리
    for(i=1;i<length;i++){
        ul[i].style.display = "none";
    }
    
    //탭 클릭 이벤트
    document.querySelector(".best_tabs").addEventListener("click",function(e){
        if(e.target && e.target.nodeName == "LI"){
            //클릭된 탭만 하이라이팅
            Array.prototype.forEach.call(e.target.parentNode.children,function(value){
                value.className = "";
            });
            e.target.className = "clicked";

            //클릭된 탭 이외의 detail은 display none 처리
            var ul = Array.from(document.querySelector(".best_container").children);
            ul.forEach(function(value){
                if(value.className == e.target.id){
                    value.style.display = "block";
                }
                else value.style.display = "none";
            });
        }
    });
}

</script>
<template id=""></template>
<div class="container">
    <div class="tab_ui">
        <img class="best_seller" src="./images/best.png">
        <ul class="best_tabs"></ul>
        <div class="best_container"></div>
    </div>
</div>

<style>
    dl, dt, dd ,ul,li {
        margin:0
    }
    .before {
        font-size:0.8em;
        color : #666;
        text-decoration: line-through;
    }
    .after{
        font-size:1.5em;
        color : #2ac1bc;
    }
    .after > span {
        font-size: 0.6em;
        color : #2ac1bc;
    }
    .price {
        text-align: right;
        margin:1em;
    }
    .best_detail dd {
        margin-top:0.4em;
        font-size: 0.8em;
        color:#666;
    }
    .best_detail dt {
        font-size: 1em;
        font-weight: bold;
        overflow: hidden;
        white-space:nowrap;
        text-overflow: ellipsis;        
    }
    .best_detail dl{
        text-align: left;
        margin:1em 0 0 1em;
        height:40px;
    }
    .best_container ul{
        padding:0;     
    }
    .best_container li {
        margin : 0.4em;
        display:inline-block;
        height:430px;
    }
    .best_container a {
        display:inline-block;
        background:#fff;
    }
    .best_container img {
        width:308px;
    }
    .best_detail{
        margin:0;
        width:304px;
    }

    * {
        box-sizing: border-box;
    }
    .container {
        background: #eee;
        text-align: center;
    }
    .tab_ui{
        margin:auto;
        width:980px;
    }
    .best_seller{
        margin-top:2em;
        margin-bottom: 1em;
    }
    .best_tabs{
        margin:0;
        padding:5px;
        overflow:auto;
    }
    .best_tabs li {
        font-weight: bold;
        padding:12px;
        margin-left:1px;
        display:inline-block;
        float:left;
        height: 48px;
        width: 160px;
        color:#777;
        background:#fff;
    }
    .best_tabs li:hover, .best_tabs li:focus , .best_tabs > .clicked {
        background: #2ac1bc;
        color:#fff;
    }


</style>