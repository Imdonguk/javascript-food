<script>
var data;   
function ajax() {
var oReq = new XMLHttpRequest();
   
 oReq.addEventListener("load", function() {
    data = JSON.parse(this.responseText);

    makeLiList();
    makeTab();
    bestTabinit();
 });
   
  oReq.open("GET", "http://crong.codesquad.kr:8080/woowa/best");
  oReq.send();
}
ajax();

//best_tabs의 li 생성 , 삽입내용 , name , category_id
function makeLiList() { 
    var ul = document.querySelector(".best_tabs");
    data.forEach(function(key,index){
        var li = '<li id="'+key.category_id+'">'+key.name+"</li>";
        ul.innerHTML += li;
    });
}

//best_detail
function makeTab(){
    var container = document.querySelector(".best_container");
    var template = document.querySelector("#bestDetail").innerText;
    data.forEach(function(key,index){
        var ul = document.createElement("ul");
        ul.className = key.category_id;
        
        key.items.forEach(function(value){ 
            var li = template;
            var keys = ["detail_hash","image","title","description","n_price","s_price"];

            keys.forEach(key => { li = li.replace(`{{${key}}}`, value[key]);});
            // keys.forEach(function(key){
            //     li = li.replace("{{"+key+"}}",value[key]);
            // });
            li = li.replace("undefined","");
            ul.innerHTML += li;

        });
        container.appendChild(ul);
    });
}


function bestTabinit(){
    var ul = document.querySelector(".best_container").children;
    var i,length = ul.length;
    
    //best_detail 하나 이외의 탭들은 display none 처리
    for(i=1;i<length;i++){
        ul[i].style.display = "none";
    }
    
    //탭 클릭 이벤트
    document.querySelector(".best_tabs").addEventListener("click",function(e){
        if(e.target && e.target.nodeName == "LI"){
            //클릭된 탭만 하이라이팅
            Array.prototype.forEach.call(e.target.parentNode.children,function(value){
                value.className = "";
            });
            e.target.className = "clicked";

            //클릭된 탭 이외의 detail은 display none 처리
            var ul = Array.from(document.querySelector(".best_container").children);
            ul.forEach(function(value){
                if(value.className == e.target.id){
                    value.style.display = "block";
                }
                else value.style.display = "none";
            });
        }
    });
}

</script>
<script type="text/template" id="bestDetail">
    <li class="{{detail_hash}}">
        <a><img src="{{image}}">
            <div class="best_detail">
                <dl>
                    <dt>{{title}}</dt>
                    <dd>{{description}}</dd>
                </dl>
                <div class="price">
                    <span class="before">{{n_price}}</span>
                    <span class="after">{{s_price}}</span>
                </div>
            </div>
        </a>
    </li>
</script>
<div class="container">
    <div class="tab_ui">
        <img class="best_seller" src="./images/best.png">
        <ul class="best_tabs"></ul>
        <div class="best_container"></div>
    </div>
</div>

<style>
    dl, dt, dd ,ul,li {
        margin:0
    }
    .before {
        margin-right:0.5em;
        font-size:0.8em;
        color : #666;
        text-decoration: line-through;
    }
    .after{
        font-size:1.5em;
        color : #2ac1bc;
    }
    .after > span {
        font-size: 0.6em;
        color : #2ac1bc;
    }
    .price {
        text-align: right;
        margin:1em;
    }
    .best_detail dd {
        margin-top:0.4em;
        font-size: 0.8em;
        color:#666;
    }
    .best_detail dt {
        font-size: 1em;
        font-weight: bold;
        overflow: hidden;
        white-space:nowrap;
        text-overflow: ellipsis;        
    }
    .best_detail dl{
        text-align: left;
        margin:1em 0 0 1em;
        height:40px;
    }
    .best_container ul{
        padding:0;     
    }
    .best_container li {
        margin : 0.4em;
        display:inline-block;
        height:430px;
    }
    .best_container a {
        display:inline-block;
        background:#fff;
    }
    .best_container img {
        width:308px;
    }
    .best_detail{
        margin:0;
        width:304px;
    }

    * {
        box-sizing: border-box;
    }
    .container {
        background: #eee;
        text-align: center;
    }
    .tab_ui{
        margin:auto;
        width:980px;
    }
    .best_seller{
        margin-top:2em;
        margin-bottom: 1em;
    }
    .best_tabs{
        margin:0;
        padding:5px;
        overflow:auto;
    }
    .best_tabs li {
        font-weight: bold;
        padding:12px;
        margin-left:1px;
        display:inline-block;
        float:left;
        height: 48px;
        width: 160px;
        color:#777;
        background:#fff;
    }
    .best_tabs li:hover, .best_tabs li:focus , .best_tabs > .clicked {
        background: #2ac1bc;
        color:#fff;
    }


</style>